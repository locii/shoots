/* global redux_change, wp */(function(e){"use strict";e.reduxBackground=e.reduxBackground||{};e(document).ready(function(){e.reduxBackground.init()});e.reduxBackground.init=function(){e(".redux-container-background .remove-image, .redux-container-background .remove-file").unbind("click").on("click",function(t){e.reduxBackground.removeImage(e(this).parents("fieldset.redux-field:first"));e.reduxBackground.preview(e(this));return!1});e(".redux-container-background .background_upload_button").unbind().on("click",function(t){e.reduxBackground.addImage(t,e(this).parents("fieldset.redux-field:first"))});e(".redux-background-input").on("change",function(){e.reduxBackground.preview(e(this))});e(".redux-container-background .redux-color").wpColorPicker({change:function(t,n){redux_change(e(this));e("#"+t.target.id+"-transparency").removeAttr("checked");e(this).val(n.color.toString());e.reduxBackground.preview(e(this))}})};e.reduxBackground.preview=function(t){var n=t.parents(".redux-container-background:first"),r=e(n).find(".body-background_previewer");if(!r)return;var i=n.data("id")+"][",s="height:"+r.height()+"px;";e(n).find(".redux-background-input").each(function(){var t=e(this).serializeArray();t=t[0];if(t&&t.name.indexOf("background]")!=-1&&t.value!==""){t.name=t.name.split(i);t.name=t.name[1].replace("]","");t.name=="background-image"?s+=t.name+':url("'+t.value+'");':s+=t.name+":"+t.value+";"}});r.attr("style",s).fadeIn()};e.reduxBackground.addImage=function(t,n){t.preventDefault();var r,i=jQuery(this);if(r){r.open();return}r=wp.media({multiple:!1,library:{},title:i.data("choose"),button:{text:i.data("update")}});r.on("select",function(){var t=r.state().get("selection").first();r.close();console.log(t.attributes.type);if(t.attributes.type!=="image")return;n.find(".upload").val(t.attributes.url);n.find(".upload-id").val(t.attributes.id);n.find(".upload-height").val(t.attributes.height);n.find(".upload-width").val(t.attributes.width);redux_change(jQuery(n).find(".upload-id"));var i=t.attributes.url;if(typeof t.attributes.sizes!="undefined"&&typeof t.attributes.sizes.thumbnail!="undefined")i=t.attributes.sizes.thumbnail.url;else if(typeof t.attributes.sizes!="undefined"){var s=t.attributes.height;for(var o in t.attributes.sizes){var u=t.attributes.sizes[o];if(u.height<s){s=u.height;i=u.url}}}else i=t.attributes.icon;n.find(".upload-thumbnail").val(i);n.find(".upload").hasClass("noPreview")||n.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+i+'">').slideDown("fast");n.find(".remove-image").removeClass("hide");n.find(".redux-background-input-properties").slideDown();e.reduxBackground.preview(n.find(".upload"))});r.open()};e.reduxBackground.removeImage=function(e){if(!e.find(".remove-image").addClass("hide"))return;e.find(".remove-image").addClass("hide");e.find(".upload").val("");e.find(".upload-id").val("");e.find(".upload-height").val("");e.find(".upload-width").val("");redux_change(jQuery(e).find(".upload-id"));e.find(".redux-background-input-properties").hide();var t=e.find(".screenshot");t.slideUp();e.find(".remove-file").unbind();jQuery(".section-upload .upload-notice").length>0&&jQuery(".background_upload_button").remove()}})(jQuery);