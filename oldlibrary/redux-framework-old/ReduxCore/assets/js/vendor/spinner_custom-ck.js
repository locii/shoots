(function(e,t){var n="ui-state-active",r="ui-state-hover",i="ui-state-disabled",s=e.ui.keyCode,o=s.UP,u=s.DOWN,a=s.RIGHT,f=s.LEFT,l=s.PAGE_UP,c=s.PAGE_DOWN,h=s.HOME,p=s.END,d=e.browser.msie,v=e.browser.mozilla?"DOMMouseScroll":"mousewheel",m=".uispinner",g=[o,u,a,f,l,c,h,p,s.BACKSPACE,s.DELETE,s.TAB],y;e.widget("ui.spinner",{options:{min:null,max:null,allowNull:!1,group:"",point:".",prefix:"",suffix:"",places:null,defaultStep:1,largeStep:10,mouseWheel:!0,increment:"slow",className:null,showOn:"always",width:95,upIconClass:"ui-icon-triangle-1-n",downIconClass:"ui-icon-triangle-1-s",format:function(e,t){var n=this,r=/(\d+)(\d{3})/,i=(isNaN(e)?0:Math.abs(e)).toFixed(t)+"";for(i=i.replace(".",n.point);r.test(i)&&n.group;i=i.replace(r,"$1"+n.group+"$2"));return(e<0?"-":"")+n.prefix+i+n.suffix},parse:function(e){var t=this;t.group=="."&&(e=e.replace(".",""));t.point!="."&&(e=e.replace(t.point,"."));return parseFloat(e.replace(/[^0-9\-\.]/g,""))}},_create:function(){var e=this,t=e.element,n=t.attr("type");if(!t.is("input")||n!="text"&&n!="number"){console.error("Invalid target for ui.spinner");return}e._procOptions(!0);e._createButtons(t);t.is(":enabled")||e.disable()},_createButtons:function(t){function i(){if(X){e(this).removeClass(n);x._stopSpin();X=!1}return!1}function v(){if(!T.disabled){var t=x.element[0],r=this===P?1:-1;t.focus();t.select();e(this).addClass(n);X=!0;x._startSpin(r)}return!1}function b(e){function t(){I=0;e()}if(I){if(e===R)return;clearTimeout(I)}R=e;I=setTimeout(t,100)}function w(e,t){if(W)return!1;var n=String.fromCharCode(t||e),r=x.options;return n>="0"&&n<="9"||n=="-"?!1:x.places>0&&n==r.point||n==r.group?!1:!0}function E(e){for(var t=0;t<g.length;t++)if(g[t]==e)return!0;return!1}function S(e){return e=="auto"?0:parseInt(e)}var x=this,T=x.options,N=T.className,C=T.width,L=T.showOn,A=e.support.boxModel,O=t.outerHeight(),M=x.oMargin=S(t.css("margin-right")),_=x.wrapper=t.wrap('<span class="spinner-wrpr" />').css({width:(x.oWidth=A?t.width():t.outerWidth())-C,marginRight:"30px",marginLeft:"30px",textAlign:"center","float":"none",marginTop:0}).after('<span class="ui-spinner ui-widget"></span>').next(),D=x.btnContainer=e('<div class="ui-spinner-buttons"><div class="ui-spinner-up ui-spinner-button ui-state-default ui-corner-tr"><span class="ui-icon '+T.upIconClass+'"> </span></div>'+'<div class="ui-spinner-down ui-spinner-button ui-state-default ui-corner-br"><span class="ui-icon '+T.downIconClass+'"> </span></div>'+"</div>"),P,H,B,F,I,R,U,z,W,X,V=t[0].dir=="rtl";N&&_.addClass(N);_.append(D.css({height:O,left:0,top:0}));B=x.buttons=D.find(".ui-spinner-button");B.css({width:"30px",height:O-(A?B.outerHeight()-B.height():0)});B.eq(0).css({right:"0"});B.eq(1).css({left:"0"});P=B[0];H=B[1];F=B.find(".ui-icon");D.width("105px");L!="always"&&D.css("opacity",0);(L=="hover"||L=="both")&&B.add(t).bind("mouseenter"+m,function(){b(function(){U=!0;(!x.focused||L=="hover")&&x.showButtons()})}).bind("mouseleave"+m,function(){b(function(){U=!1;(!x.focused||L=="hover")&&x.hideButtons()})});B.hover(function(){x.buttons.removeClass(r);T.disabled||e(this).addClass(r)},function(){e(this).removeClass(r)}).mousedown(v).mouseup(i).mouseout(i);d&&B.dblclick(function(){if(!T.disabled){x._change();x._doSpin((this===P?1:-1)*T.step)}return!1}).bind("selectstart",function(){return!1});t.bind("keydown"+m,function(t){var r,i,s,d=t.keyCode;if(t.ctrl||t.alt)return!0;E(d)&&(W=!0);if(z)return!1;switch(d){case o:case l:r=1;i=d==l;break;case u:case c:r=-1;i=d==c;break;case a:case f:r=d==a^V?1:-1;break;case h:s=x.options.min;s!=null&&x._setValue(s);return!1;case p:s=x.options.max;s=x.options.max;s!=null&&x._setValue(s);return!1}if(r){if(!z&&!T.disabled){keyDir=r;e(r>0?P:H).addClass(n);z=!0;x._startSpin(r,i)}return!1}}).bind("keyup"+m,function(e){if(e.ctrl||e.alt)return!0;E(s)&&(W=!1);switch(e.keyCode){case o:case a:case l:case u:case f:case c:B.removeClass(n);x._stopSpin();z=!1;return!1}}).bind("keypress"+m,function(e){if(w(e.keyCode,e.charCode))return!1}).bind("change"+m,function(){x._change()}).bind("focus"+m,function(){function e(){x.element.select()}d?e():setTimeout(e,0);x.focused=!0;y=x;!U&&(L=="focus"||L=="both")&&x.showButtons()}).bind("blur"+m,function(){x.focused=!1;!U&&(L=="focus"||L=="both")&&x.hideButtons()})},_procOptions:function(e){var t=this,n=t.element,r=t.options,i=r.min,s=r.max,o=r.step,u=r.places,a=-1,f;r.increment=="slow"?r.increment=[{count:1,mult:1,delay:250},{count:3,mult:1,delay:100},{count:0,mult:1,delay:50}]:r.increment=="fast"&&(r.increment=[{count:1,mult:1,delay:250},{count:19,mult:1,delay:100},{count:80,mult:1,delay:20},{count:100,mult:10,delay:20},{count:0,mult:100,delay:20}]);i==null&&(f=n.attr("min"))!=null&&(i=parseFloat(f));s==null&&(f=n.attr("max"))!=null&&(s=parseFloat(f));if(!o&&(f=n.attr("step"))!=null&&f!="any"){o=parseFloat(f);r.largeStep*=o}r.step=o=o||r.defaultStep;u==null&&(f=o+"").indexOf(".")!=-1&&(u=f.length-f.indexOf(".")-1);t.places=u;if(s!=null&&i!=null){i>s&&(i=s);a=Math.max(Math.max(a,r.format(s,u,n).length),r.format(i,u,n).length)}e&&(t.inputMaxLength=n[0].maxLength);f=t.inputMaxLength;if(f>0){a=a>0?Math.min(f,a):f;f=Math.pow(10,a)-1;if(s==null||s>f)s=f;f=-(f+1)/10+1;if(i==null||i<f)i=f}a>0&&n.attr("maxlength",a);r.min=i;r.max=s;t._change();n.unbind(v+m);r.mouseWheel&&n.bind(v+m,t._mouseWheel)},_mouseWheel:function(t){var n=e.data(this,"spinner");if(!n.options.disabled&&n.focused&&y===n){n._change();n._doSpin(((t.wheelDelta||-t.detail)>0?1:-1)*n.options.step);return!1}},_setTimer:function(e,t,n){function r(){i._spin(t,n)}var i=this;i._stopSpin();i.timer=setInterval(r,e)},_stopSpin:function(){if(this.timer){clearInterval(this.timer);this.timer=0}},_startSpin:function(e,t){var n=this,r=n.options,i=r.increment;n._change();n._doSpin(e*(t?n.options.largeStep:n.options.step));if(i&&i.length>0){n.counter=0;n.incCounter=0;n._setTimer(i[0].delay,e,t)}},_spin:function(e,t){var n=this,r=n.options.increment,i=r[n.incCounter];n._doSpin(e*i.mult*(t?n.options.largeStep:n.options.step));n.counter++;if(n.counter>i.count&&n.incCounter<r.length-1){n.counter=0;i=r[++n.incCounter];n._setTimer(i.delay,e,t)}},_doSpin:function(e){var t=this,n=t.curvalue;n==null&&(n=(e>0?t.options.min:t.options.max)||0);t._setValue(n+e)},_parseValue:function(){var e=this.element.val();return e?this.options.parse(e,this.element):null},_validate:function(e){var t=this.options,n=t.min,r=t.max;e==null&&!t.allowNull&&(e=this.curvalue!=null?this.curvalue:n||r||0);return r!=null&&e>r?r:n!=null&&e<n?n:e},_change:function(){var e=this,t=e._parseValue(),n=e.options.min,r=e.options.max;if(!e.selfChange){isNaN(t)&&(t=e.curvalue);e._setValue(t,!0)}},_setOption:function(t,n){e.Widget.prototype._setOption.call(this,t,n);this._procOptions()},increment:function(){this._doSpin(this.options.step)},decrement:function(){this._doSpin(-this.options.step)},showButtons:function(e){var t=this.btnContainer.stop();e?t.css("opacity",1):t.fadeTo("fast",1)},hideButtons:function(e){var t=this.btnContainer.stop();e?t.css("opacity",0):t.fadeTo("fast",0);this.buttons.removeClass(r)},_setValue:function(e,t){var n=this;n.curvalue=e=n._validate(e);n.element.val(e!=null?n.options.format(e,n.places,n.element):"");if(!t){n.selfChange=!0;n.element.change();n.selfChange=!1}},value:function(e){if(arguments.length){this._setValue(e);return this.element}return this.curvalue},enable:function(){this.buttons.removeClass(i);this.element[0].disabled=!1;e.Widget.prototype.enable.call(this)},disable:function(){this.buttons.addClass(i).removeClass(r);this.element[0].disabled=!0;e.Widget.prototype.disable.call(this)},destroy:function(t){this.wrapper.remove();this.element.unbind(m).css({width:this.oWidth,marginRight:this.oMargin});e.Widget.prototype.destroy.call(this)}})})(jQuery);